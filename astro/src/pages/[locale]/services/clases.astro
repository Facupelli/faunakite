---
import { useTranslations } from "../../../i18n/utils";
import ServicesLayout from "../../../layouts/services-layout.astro";
import ClaseAvanzadaPhoto from "../../../assets/what-we-offer/clases/clase-avanzada.webp";
import ClaseIndividualPhoto from "../../../assets/what-we-offer/clases/clase-individual.webp";
import ClasePruebaPhoto from "../../../assets/what-we-offer/clases/clase-prueba.webp";
import ClaseWingfoilPhoto from "../../../assets/what-we-offer/clases/clase-wingfoil.webp";
import CursoInicialPhoto from "../../../assets/what-we-offer/clases/curso-inicial.webp";
import CursoIntensivoPhoto from "../../../assets/what-we-offer/clases/curso-intensivo.webp";
import CursoZeroToKiterPhoto from "../../../assets/what-we-offer/clases/curso-zero-to-kiter.webp";
import ClassCard from "../../../components/clases/class-card.astro";

export async function getStaticPaths() {
  return [{ params: { locale: "en" } }, { params: { locale: "es" } }];
}

const lang = Astro.params.locale as "en" | "es";
const t = useTranslations(lang);
---

<ServicesLayout>
  <Fragment slot="header">
    <div class="max-w-6xl mx-auto pb-30">
      <div class="space-y-8 text-white text-lg md:text-xl px-4">
        <p>
          {t("services.intro.p1")}
        </p>

        <p>
          {t("services.intro.p2")}
        </p>
      </div>
    </div>
  </Fragment>

  <div
    class="max-w-[1800px] mx-auto px-4 md:px-10 space-y-20 pt-10"
    id="courses-container"
    data-lang={lang}
  >
    <!-- CURSOS -->
    <div class="flex flex-col gap-10">
      <div class="">
        <h2 class="text-5xl text-brand-blue font-bold uppercase font-salted">
          {t("services.kite.courses.title")}
        </h2>
      </div>

      <div class="grid md:grid-cols-2 gap-10 items-start">
        <ClassCard
          image={CursoZeroToKiterPhoto}
          imageAlt="De Cero a Kitero"
          title={t("services.kite.zeroToKiter.title")}
          duration={t("services.kite.zeroToKiter.duration")}
          level={t("services.kite.zeroToKiter.level")}
          mode={t("services.kite.zeroToKiter.mode")}
          descriptions={[
            t("services.kite.zeroToKiter.p1"),
            t("services.kite.zeroToKiter.p2"),
            t("services.kite.zeroToKiter.p3"),
            t("services.kite.zeroToKiter.p4"),
            t("services.kite.zeroToKiter.p5"),
          ]}
          courseType="curso-cero-a-kitero"
        />

        <ClassCard
          image={CursoInicialPhoto}
          imageAlt="Curso Inicial"
          title={t("services.kite.initial.title")}
          duration={t("services.kite.initial.duration")}
          level={t("services.kite.initial.level")}
          mode={t("services.kite.initial.mode")}
          descriptions={[
            t("services.kite.initial.p1"),
            t("services.kite.initial.p2"),
            t("services.kite.initial.p3"),
            t("services.kite.initial.p4"),
            t("services.kite.initial.p5"),
          ]}
          mostPopular
          courseType="curso-inicial"
        />

        <ClassCard
          image={CursoIntensivoPhoto}
          imageAlt="Curso Intensivo"
          imageClass="object-[50%_90%]"
          title={t("services.kite.intensive.title")}
          duration={t("services.kite.intensive.duration")}
          level={t("services.kite.intensive.level")}
          mode={t("services.kite.intensive.mode")}
          descriptions={[
            t("services.kite.intensive.p1"),
            t("services.kite.intensive.p2"),
            t("services.kite.intensive.p3"),
            t("services.kite.intensive.p4"),
          ]}
          courseType="curso-intensivo"
        />
      </div>
    </div>

    <!-- CLASES -->
    <div class="flex flex-col gap-10">
      <div class="">
        <h2 class="text-5xl text-brand-blue font-bold uppercase font-salted">
          {t("services.kite.classes.title")}
        </h2>
      </div>
      <div class="grid md:grid-cols-2 gap-10 items-start">
        <ClassCard
          image={ClaseIndividualPhoto}
          imageAlt="Clase Individual"
          title={t("services.kite.class.individual.title")}
          duration={t("services.kite.class.individual.duration")}
          level={t("services.kite.class.individual.level")}
          descriptions={[
            t("services.kite.class.individual.p1"),
            t("services.kite.class.individual.p2"),
          ]}
          courseType="clase-individual"
        />

        <ClassCard
          image={ClaseAvanzadaPhoto}
          imageAlt="Clase Avanzada"
          title={t("services.kite.class.advanced.title")}
          duration={t("services.kite.class.advanced.duration")}
          level={t("services.kite.class.advanced.level")}
          descriptions={[
            t("services.kite.class.advanced.p1"),
            t("services.kite.class.advanced.p2"),
            t("services.kite.class.advanced.p3"),
            t("services.kite.class.advanced.p4"),
          ]}
          courseType="clase-avanzada"
        />

        <ClassCard
          image={ClasePruebaPhoto}
          imageAlt="Clase Prueba"
          imageClass="object-[50%_90%]"
          title={t("services.kite.class.try.title")}
          duration={t("services.kite.class.try.duration")}
          level={t("services.kite.class.try.level")}
          mode={t("services.kite.class.try.mode")}
          descriptions={[
            t("services.kite.class.try.p1"),
            t("services.kite.class.try.p2"),
            t("services.kite.class.try.p3"),
            t("services.kite.class.try.p4"),
          ]}
          courseType="clase-prueba"
        />
      </div>
    </div>

    <!-- WINGFOIL -->
    <div class="flex flex-col gap-10">
      <div class="">
        <h2 class="text-5xl text-brand-blue font-bold uppercase font-salted">
          {t("services.wingfoil.title")}
        </h2>
      </div>
      <div class="grid md:grid-cols-2 gap-10 items-start">
        <ClassCard
          image={ClaseWingfoilPhoto}
          imageAlt="Clase Wingfoil"
          title={t("services.wingfoil.class.title")}
          descriptions={[
            t("services.wingfoil.class.p1"),
            t("services.wingfoil.class.p2"),
          ]}
          courseType="clase-wingfoil"
        />
      </div>
    </div>
  </div>
</ServicesLayout>

<script>
  import { initializeWhatsAppButtons } from "../../../modules/utils/whatsapp";

  const courseMessages = {
    "curso-cero-a-kitero": {
      es: `¡Hola! Mi nombre es: _____
Me gustaría tomar el *Curso De Cero a Kitero 12hs* con ustedes en *Cuesta del Viento*
Voy: Solo/a / con __ personas más
Fechas: _____
¿Tienen disponibilidad? ¡Gracias!`,
      en: `Hello! My name is: _____
I would like to take the *From Zero to Hero 12-Hour Course* with you at *Cuesta del Viento*
I'm going: Alone / with __ more people
Dates: _____
Do you have availability? Thanks!`,
    },
    "curso-inicial": {
      es: `¡Hola! Mi nombre es: _____
Me gustaría tomar el *Curso Inicial de 9hs* con ustedes en *Cuesta del Viento*
Voy: Solo/a / con __ personas más
Fechas: _____
¿Tienen disponibilidad? ¡Gracias!`,
      en: `Hello! My name is: _____
I would like to take the *Initial 9-Hour Course* with you at *Cuesta del Viento*
I'm going: Alone / with __ more people
Dates: _____
Do you have availability? Thanks!`,
    },
    "curso-intensivo": {
      es: `¡Hola! Mi nombre es: _____
Me gustaría tomar *6 hs de clase* con ustedes en *Cuesta del Viento*
Mi nivel es: _____
Voy: Solo/a / con __ personas más
Fechas: _____
¿Tienen disponibilidad? ¡Gracias!`,
      en: `Hello! My name is: _____
I would like to take *6 hours of class* with you at *Cuesta del Viento*
My level is: _____
I'm going: Alone / with __ more people
Dates: _____
Do you have availability? Thanks!`,
    },
    "clase-individual": {
      es: `¡Hola! Mi nombre es: _____
Me gustaría reservar una *Clase Individual/Avanzada* con ustedes en *Cuesta del Viento*
Mi nivel es: _____
Viajo: Solo/a / con __ personas más
Fechas: _____
Objetivos: _____
¿Tienen disponibilidad? ¡Gracias!`,
      en: `Hello! My name is: _____
I would like to book an *Individual/Advanced Class* with you at *Cuesta del Viento*
My level is: _____
I'm traveling: Alone / with __ more people
Dates: _____
Objectives: _____
Do you have availability? Thanks!`,
    },
    "clase-avanzada": {
      es: `¡Hola! Mi nombre es: _____
Me gustaría reservar una *Clase Individual/Avanzada* con ustedes en *Cuesta del Viento*
Mi nivel es: _____
Viajo: Solo/a / con __ personas más
Fechas: _____
Objetivos: _____
¿Tienen disponibilidad? ¡Gracias!`,
      en: `Hello! My name is: _____
I would like to book an *Individual/Advanced Class* with you at *Cuesta del Viento*
My level is: _____
I'm traveling: Alone / with __ more people
Dates: _____
Objectives: _____
Do you have availability? Thanks!`,
    },
    "clase-prueba": {
      es: `¡Hola! Mi nombre es: _____
Me gustaría agendar una *Clase de Prueba* con FAUNA en *Cuesta del Viento*
Mis fechas posibles son: _____
¿Tienen disponibilidad? ¡Gracias!`,
      en: `Hello! My name is: _____
I would like to schedule a *Trial Class* with FAUNA at *Cuesta del Viento*
My possible dates are: _____
Do you have availability? Thanks!`,
    },
    "clase-wingfoil": {
      es: `¡Hola! Mi nombre es: _____
Me gustaría tomar una *Clase de Wingfoil* con ustedes en *Cuesta del Viento*
Mi nivel es: _____
Voy: Solo/a / con __ personas más
Fechas: _____
¿Tienen disponibilidad? ¡Gracias!`,
      en: `Hello! My name is: _____
I would like to take a *Wingfoil Class* with you at *Cuesta del Viento*
My level is: _____
I'm going: Alone / with __ more people
Dates: _____
Do you have availability? Thanks!`,
    },
  };

  function initializeExpandable() {
    const container: HTMLElement | null =
      document.getElementById("courses-container");

    container?.addEventListener("click", (e) => {
      if (!(e.target instanceof HTMLElement)) {
        return;
      }

      const btn = e.target.closest(".expand-toggle");
      if (!btn) {
        return;
      }

      const panelId = btn.getAttribute("aria-controls");
      if (!panelId) {
        return;
      }

      const panel = document.getElementById(panelId);
      if (!panel) {
        return;
      }

      const isExpanded = btn.getAttribute("aria-expanded") === "true";
      const newExpanded = !isExpanded;

      btn.setAttribute("aria-expanded", String(newExpanded));

      panel.setAttribute("aria-hidden", String(!newExpanded));

      const textSpan = btn.querySelector(".expand-text");
      if (textSpan) {
        const moreText = btn.getAttribute("data-text-more") || "Ver más";
        const lessText = btn.getAttribute("data-text-less") || "Ver menos";
        textSpan.textContent = newExpanded ? lessText : moreText;
      }
    });
  }

  // Initialize on page load
  document.addEventListener("astro:page-load", () => {
    const container = document.getElementById("courses-container");
    const lang = (container?.getAttribute("data-lang") || "es") as "en" | "es";

    initializeWhatsAppButtons(courseMessages, lang);
    initializeExpandable();
  });
</script>
