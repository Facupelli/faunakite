---
import Layout from "../../layouts/Layout.astro";
import Seo from "../../components/seo.astro";
import { formatDate } from "../../modules/news/date.utils";
import { getNews, type News } from "../../modules/news/utils";
import Nav from "../../components/nav.astro";
import TheSpotTopSeparator from "../../components/svg/the-spot-top-separator.astro";
import Footer from "../../components/footer.astro";
import { urlFor } from "../../modules/news/image.utils";
import { Image } from "astro:assets";
import headerImage from "../../assets/hero/hero-desktop.webp";

export async function getStaticPaths() {
  return [{ params: { locale: "en" } }, { params: { locale: "es" } }];
}

const lang = Astro.params.locale as "en" | "es";
const posts: News[] = await getNews(lang);

function getOptimizedImageUrl(
  image: any,
  width: number,
  format: "webp" = "webp",
) {
  return urlFor(image).width(width).format(format).quality(85).url();
}

function getImageSrcSet(image: any, sizes: number[]) {
  return sizes
    .map(
      (size) =>
        `${urlFor(image).width(size).format("webp").quality(85).url()} ${size}w`,
    )
    .join(", ");
}
---

<Layout title="Noticias | Fauna Kite " locale={Astro.params.locale}>
  <Fragment slot="head">
    <Seo />
    <meta
      name="description"
      content="Últimas noticias de FAUNA Kite. Eventos, competencias, y todo el mundo del kitesurf en Cuesta del Viento y Argentina."
    />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="FAUNA Kite" />
    <meta property="og:title" content="Noticias | FAUNA Kite" />
    <meta
      property="og:description"
      content="Últimas noticias de FAUNA Kite. Eventos, competencias, y todo el mundo del kitesurf en Cuesta del Viento y Argentina."
    />
    <meta
      property="og:url"
      content={`https://faunakite.com/${Astro.params.locale}/news`}
    />
    <meta
      property="og:image"
      content="https://faunakite.com/og/fauna-news.jpg"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Noticias | FAUNA Kite" />
    <meta
      name="twitter:description"
      content="Últimas noticias de FAUNA Kite. Eventos, competencias, y todo el mundo del kitesurf en Cuesta del Viento y Argentina."
    />
    <meta
      name="twitter:image"
      content="https://faunakite.com/og/fauna-news.jpg"
    />
  </Fragment>
  <header>
    <Nav />
  </header>

  <main class="min-h-dvh bg-brand-light">
    <div class="relative w-full h-[220px] md:h-[300px]">
      <div class="absolute inset-0">
        <Image
          src={headerImage}
          alt="Header background"
          fetchpriority="high"
          class="w-full h-full object-cover object-[80%_70%]"
          widths={[640, 768, 1024, 1280, 1920]}
          sizes="100vw"
          quality={92}
        />
      </div>

      <div
        class="flex justify-center max-w-4xl mx-auto relative z-20 h-full items-end pb-4 md:pb-10"
      >
        <h1
          class="font-salted text-shadow-2xs text-shadow-brand-blue text-6xl md:text-8xl pr-4 md:pr-0"
        >
          NEWS
        </h1>
      </div>

      <div class="absolute bottom-0 left-0 w-full text-brand-light">
        <TheSpotTopSeparator />
      </div>
    </div>

    <div class="relative">
      <div
        class="bg-brand-light min-h-dvh bg-[url('/cuesta-del-viento/white-wave-contrast-2.png')] bg-size-[42px_auto]"
      >
        <div class="mx-auto max-w-3xl px-5 py-12">
          <div class="relative flex flex-col gap-6">
            {
              posts.map((post) => (
                <a
                  href={`/${lang}/news/${post.slug.current}`}
                  class="block bg-white shadow-news-card p-4 rounded-2xl cursor-pointer hover:scale-[1.005] will-change-transform scale-100 active:scale-100 transition-all duration-150"
                >
                  <article class="flex items-center justify-between ">
                    <div class="basis-2/3 shrink-0 pr-4 flex flex-col justify-center">
                      <h2 class="text-xl md:text-[28px] font-bold text-brand-red leading-none mb-2">
                        {post.title}
                      </h2>
                      <p class="text-[13px] text-brand-blue/90">
                        {formatDate(post._createdAt)}
                      </p>
                      <p class="mt-1 text-brand-blue line-clamp-2 md:line-clamp-3">
                        {post.summary}
                      </p>
                    </div>

                    {post.images && post.images.length > 0 && (
                      <div class="basis-1/3 h-36">
                        <img
                          src={getOptimizedImageUrl(post.images[0], 300)}
                          srcset={getImageSrcSet(post.images[0], [300, 600])}
                          sizes="(max-width: 768px) 100px, 300px"
                          alt={post.images[0].alt}
                          loading="lazy"
                          decoding="async"
                          class="object-cover w-full h-full rounded-sm"
                        />
                      </div>
                    )}
                  </article>
                </a>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </main>

  <Footer />
</Layout>
