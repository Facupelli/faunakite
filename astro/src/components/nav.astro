---
import { Image } from "astro:assets";
import logo from "../assets/logos/logo-blanco-03.png";
import { useTranslations } from "../i18n/utils";
import LanguagePicker from "./language-picker.astro";
import { Icon } from "astro-icon/components";
import { storeUrl } from "../modules/store/constants";

const lang = Astro.params.locale as "en" | "es";
const t = useTranslations(lang);

const links = [
  { name: t("nav.services"), href: `/${lang}/services` },
  { name: t("nav.about"), href: `/${lang}/about-us` },
  { name: t("nav.spot"), href: `/${lang}/cuesta-del-viento` },
  { name: t("nav.allies"), href: `/${lang}/allies` },
  { name: t("nav.news"), href: `/${lang}/news` },
  {
    name: t("nav.store"),
    href: storeUrl,
    props: { target: "_blank", rel: "noopener noreferrer" },
  },
];
---

<nav
  class="fixed top-0 left-0 right-0 z-50 h-20 bg-[rgba(0,0,0,0.1)] backdrop-blur-sm will-change-[backdrop-filter] transform-[translateZ(0)] border-b border-white"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-white font-bold">
    <div class="h-20 flex justify-between">
      <div class="flex items-center justify-between">
        <a href="/">
          <div
            class="relative w-full max-w-[100px] aspect-[3.45/1] flex items-center justify-center"
          >
            <Image decoding="async" src={logo} alt="Logo FaunaKite white" />
          </div>
        </a>
      </div>

      <div class="hidden md:flex items-center gap-12 uppercase">
        {
          links.map((link) => (
            <a
              class="hover:text-brand-red text-shadow-md"
              href={link.href}
              {...link.props}
            >
              {link.name}
            </a>
          ))
        }
        <LanguagePicker />
      </div>

      <button
        id="mobile-menu-button"
        class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-white"
        aria-label="Open menu"
        aria-expanded="false"
      >
        <Icon name="hamburger" class="size-8" />
      </button>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div
    id="mobile-menu"
    class="hidden fixed inset-0 bg-brand-blue text-white z-40 md:hidden h-dvh"
  >
    <div class="flex flex-col h-full">
      <!-- Mobile Menu Header -->
      <div
        class="flex justify-between items-center h-20 px-4 border-b border-white"
      >
        <a href="/">
          <div class="relative w-full max-w-[150px] aspect-[3.45/1]">
            <Image
              decoding="async"
              src={logo}
              alt="Logo FaunaKite white icon"
            />
          </div>
        </a>
        <button
          id="mobile-menu-close"
          class="p-2 rounded-md text-white hover:text-gray-900 hover:bg-gray-100 transition-colors"
          aria-label="Close menu"
        >
          <Icon name="cross" class="size-8" />
        </button>
      </div>

      <!-- Mobile Menu Links -->
      <div class="flex flex-col px-6 py-6 space-y-8 font-bold uppercase">
        {links.map((link) => <a href={link.href}>{link.name}</a>)}
      </div>
    </div>
  </div>

  <script is:inline>
    const menuButton = document.getElementById("mobile-menu-button");
    const menuClose = document.getElementById("mobile-menu-close");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuLinks = mobileMenu?.querySelectorAll("a");

    function openMenu() {
      mobileMenu?.classList.remove("hidden");
      menuButton?.setAttribute("aria-expanded", "true");
      document.body.style.overflow = "hidden";
    }

    function closeMenu() {
      mobileMenu?.classList.add("hidden");
      menuButton?.setAttribute("aria-expanded", "false");
      document.body.style.overflow = "";
    }

    menuButton?.addEventListener("click", openMenu);
    menuClose?.addEventListener("click", closeMenu);

    menuLinks?.forEach((link) => {
      link.addEventListener("click", closeMenu);
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !mobileMenu?.classList.contains("hidden")) {
        closeMenu();
      }
    });
  </script>
</nav>
